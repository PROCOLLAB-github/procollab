<!-- @format -->

@if (program()) {
<main class="project">
  <section class="program__main">
    <!-- advertisementImageAddress –ø–æ–ª–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Ö –∫—Ç–æ –Ω–µ —É—á–∞—Å—Ç–Ω–∏–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã –ø–æ—ç—Ç–æ–º—É –Ω–µ–ª—å–∑—è —Å–¥–µ–ª–∞—Ç—å toggle –∏ –¥–∞–≤–∞—Ç—å –ø–æ—è–≤–ª—è—Ç—å—Å—è –∏–ª–∏ –Ω–µ—Ç –ø–æ–ª—é -->
    @if (!program()!.isUserMember && !program()!.isUserManager) {
    <div class="program__advertisement">
      <img [src]="program()!.advertisementImageAddress" [alt]="program()!.name" />
    </div>
    } @else {
    <div class="program__details">
      <div class="program__left">
        <aside class="program__aside">
          @if (program()!.isUserMember) {
          <app-soon-card
            title="–∞–Ω–∞–ª–∏—Ç–∏–∫–∞"
            description="—É—Ä–æ–≤–µ–Ω—å –≤–∫–ª—é—á—ë–Ω–Ω–æ—Å—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–π –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö"
          ></app-soon-card>
          }
        </aside>
      </div>

      <div class="program__content">
        <div class="about program__about">
          <div class="about__head">
            <h3 class="text-body-12 about__title">–æ –ø—Ä–æ–≥—Ä–∞–º–º–µ</h3>
            <i appIcon icon="folder" appSquare="12" class="about__head--icon"></i>
          </div>
          @if (program()!.description) {
          <div class="text-body-10 about__text">
            <p #descEl [innerHTML]="program()!.description | parseLinks | parseBreaks"></p>
            @if (descriptionExpandable()) {
            <div
              class="read-more"
              (click)="onExpandDescription(descEl, 'expanded', readFullDescription())"
            >
              {{ readFullDescription() ? "c–∫—Ä—ã—Ç—å" : "–ø–æ–¥—Ä–æ–±–Ω–µ–µ" }}
            </div>
            }
          </div>
          }
        </div>
        <div class="news">
          @if (program()!.isUserManager) {
          <app-news-form class="news__form" (addNews)="onAddNews($event)"></app-news-form>
          } @for (n of news(); track n.id) {
          <app-news-card
            class="news__item"
            [attr.data-id]="n.id"
            [resourceLink]="['/office/program', program()!.id]"
            [feedItem]="n"
            [isOwner]="program()!.isUserMember"
            (like)="onLike($event)"
            (edited)="onEdit($event, n.id)"
            (delete)="onDelete($event)"
          ></app-news-card>
          }
        </div>
      </div>

      <div class="program__right">
        <aside class="program__aside">
          @if (program()!.isUserMember && (program()!.links?.length && program()!.links)) {
          <div class="links program__section">
            <div class="links__section">
              <h3 class="links__title text-body-12">–∫–æ–Ω—Ç–∞–∫—Ç—ã</h3>
              <i appIcon icon="phone" class="links__icon" appSquare="12"></i>
            </div>
            <ul>
              @for (link of program()!.links; track $index) {
              <li class="contact-link links__item text-body-10">
                @if (link | userLinks; as l) {
                <a
                  class="contact-link__link"
                  target="_blank"
                  [href]="link.includes('@') ? 'mailto:' + link : link"
                >
                  <i class="contact-link__icon" appIcon [icon]="l.iconName" appSquare="10"></i>
                  <span>{{ l.tag | truncate: 30 }}</span>
                </a>
                }
              </li>
              }
            </ul>
          </div>
          }
        </aside>

        <aside class="program__aside">
          @if (program()!.isUserMember && (program()!.materials?.length && program()!.materials)) {
          <div class="links program__section">
            <div class="links__section">
              <h3 class="links__title text-body-12">–º–∞—Ç–µ—Ä–∏–∞–ª—ã</h3>
              <i appIcon icon="book" appSquare="12" class="links__icon"></i>
            </div>
            <ul>
              @for (material of program()!.materials; track $index) {
              <li class="contact-link links__item text-body-10">
                @if (material.url | userLinks; as l) {
                <a
                  class="contact-link__link"
                  target="_blank"
                  [href]="material.url.includes('@') ? 'mailto:' + material.url : material.url"
                >
                  <i class="contact-link__icon" appIcon [icon]="l.iconName" appSquare="10"></i>
                  <span>{{ material.title | truncate: 30 }}</span>
                </a>
                }
              </li>
              }
            </ul>
          </div>
          }
        </aside>
      </div>
    </div>
    }
  </section>
</main>

<app-modal [open]="showProgramModal()" (openChange)="showProgramModal.set(!showProgramModal())">
  <div class="cancel">
    <div class="cancel__top">
      <i appIcon icon="cross" class="cancel__cross" appSquare="12" (click)="closeModal()"></i>
      <p class="cancel__title text-body-12">
        –≤—ã –Ω–µ —è–≤–ª—è–µ—Ç–µ—Å—å —ç–∫—Å–ø–µ—Ä—Ç–æ–º –∏–ª–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–º –ø—Ä–æ–≥—Ä–∞–º–º—ã!
      </p>
    </div>

    @if (showProgramModalErrorMessage()) {
    <p class="text-body-10 cancel__text">
      {{ showProgramModalErrorMessage() }}
    </p>
    }

    <app-button
      class="cancel__button"
      size="medium"
      (click)="closeModal()"
      customTypographyClass="text-body-10"
      >—Ö–æ—Ä–æ—à–æ</app-button
    >
  </div>
</app-modal>

<app-modal
  [open]="isAssignProjectToProgramError()"
  (openChange)="isAssignProjectToProgramError() ? clearAssignProjectToProgramError() : null"
>
  <div class="cancel" style="padding: 24px">
    <div class="cancel__top">
      <p class="cancel__title text-body-14">–æ—à–∏–±–∫–∞ –ø—Ä–∏–≤—è–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∫ –ø—Ä–æ–≥—Ä–∞–º–º–µ!</p>
    </div>

    <p class="text-body-10 cancel__text">
      {{ (errorAssignProjectToProgramModalMessage()?.non_field_errors)![0] }}
    </p>

    <app-button
      size="medium"
      class="cancel__button"
      customTypographyClass="text-body-12"
      (click)="clearAssignProjectToProgramError()"
      >–ø–æ–Ω—è—Ç–Ω–æ</app-button
    >
  </div>
</app-modal>

<app-modal [open]="registeredProgramModal()" (openChange)="registeredProgramModal.set(false)">
  <div class="cancel" style="width: 605px; padding: 0px 24px">
    <div class="cancel__top">
      <p class="cancel__title text-body-14">–ø–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º—É! üéâ</p>
    </div>

    <div class="cancel__text-block">
      <p class="text-body-12">
        –≠—Ç–æ –∑–∞–∫—Ä—ã—Ç–∞—è –≥—Ä—É–ø–ø–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã ‚Äì –¥–æ—Å—Ç—É–ø –∫ –Ω–µ–π –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ —É –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
      </p>

      <p class="text-body-12">–ó–¥–µ—Å—å –≤—ã –Ω–∞–π–¥–µ—Ç–µ:</p>

      <ul class="cancel__text-list">
        <li class="text-body-12">
          —Å–∞–º—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∏ –≤–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ü–æ–ª–æ–∂–µ–Ω–∏–µ)
        </li>
        <li class="text-body-12">–∫–æ–Ω—Ç–∞–∫—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤ –¥–ª—è —Å–≤—è–∑–∏</li>
        <li class="text-body-12">–Ω–æ–≤–æ—Å—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã</li>
      </ul>

      <p class="text-body-12">
        –í–∞–∂–Ω–æ: –∏–º–µ–Ω–Ω–æ —á–µ—Ä–µ–∑ –∑–∞–∫—Ä—ã—Ç—É—é –≥—Ä—É–ø–ø—É –∏ –∫–Ω–æ–ø–∫—É ¬´–ø–æ–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç¬ª –≤—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        —Ä–∞–±–æ—Ç—ã —Å–≤–æ–µ–π –∫–æ–º–∞–Ω–¥—ã, –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã
      </p>

      <p class="text-body-12">
        –ë—É–¥—å—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã: –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏—é –¥–µ–¥–ª–∞–π–Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º–∏, –∫–Ω–æ–ø–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è
        –Ω–µ–∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–π üëª
      </p>
    </div>

    <app-button
      customTypographyClass="text-body-12"
      size="medium"
      (click)="registeredProgramModal.set(false)"
      >—Å–ø–∞—Å–∏–±–æ, –ø–æ–Ω—è—Ç–Ω–æ</app-button
    >
  </div>
</app-modal>
}
