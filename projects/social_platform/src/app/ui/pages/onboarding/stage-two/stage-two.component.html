<!-- @format -->

<div class="page">
  <div class="auth__greeting">
    <div class="tooltip">
      <h3 class="text-heading-3">Кем хочешь работать?</h3>
      <app-tooltip
        [text]="
          'Постарайся вспомнить все, чему тебя учили и то, что ты делал (читать, считать, программировать) Постарайся не врать, но и не будь сильно критичным к себе.'
        "
        [isVisible]="isHintAuthVisible()"
        [position]="'right'"
        [tooltipWidth]="300"
        customClass="tooltip__hint"
        (show)="toggleTooltip('show', 'auth')"
        (hide)="toggleTooltip('hide', 'auth')"
      ></app-tooltip>
    </div>
    <div class="content__actions">
      <app-button
        size="big"
        (click)="onSkipRegistration()"
        customTypographyClass="text-body-12"
        color="grey"
        [loader]="skipSubmitting()"
        >закончить регистрацию позже</app-button
      >
      <app-button
        size="big"
        type="submit"
        customTypographyClass="text-body-12"
        [loader]="stageSubmitting()"
        (click)="onSubmit()"
        >продолжить</app-button
      >
    </div>
    <!-- <p class="auth__info">
      Для того, чтобы участники понимали с кем общаются и платформа могла рекомендовать тебя на
      самые подходящие вакансии
    </p> -->
  </div>
  <div class="content" [formGroup]="stageForm">
    <section class="content__section content__left">
      <div class="content__search">
        <h4 class="text-heading-4 content__section-heading">поиск по библиотеке</h4>
        <app-autocomplete-input
          [suggestions]="searchedSkills()"
          fieldToDisplay="name"
          [clearInputOnSelect]="true"
          [forceSelect]="true"
          placeholder="Название навыка"
          (searchStart)="onSearchSkill($event)"
          (optionSelected)="onAddSkill($event)"
        ></app-autocomplete-input>
      </div>
      <div class="content__skills">
        <h4 class="text-heading-4">выбранные навыки</h4>
        <app-skills-basket
          class="content__skills-basket"
          formControlName="skills"
          [error]="stageForm.controls['skills'] | controlError"
        ></app-skills-basket>
      </div>
    </section>
    <section class="content__section content__right">
      <div class="auth__greeting content__right-heading">
        <div class="tooltip">
          <h4 class="text-heading-4">библиотека</h4>
          <app-tooltip
            [text]="
              'База с навыками, которая может пополняться благодаря тебе! Если не найдешь свой навык, смело пиши на @procollab_support и мы добавим твой уникальный навык'
            "
            [isVisible]="isHintLibVisible()"
            [position]="'right'"
            [tooltipWidth]="300"
            customClass="tooltip__hint"
            (show)="toggleTooltip('show', 'lib')"
            (hide)="toggleTooltip('show', 'lib')"
          ></app-tooltip>
        </div>
      </div>
      <div class="content__skills-groups">
        <ul class="content__skills-groups-list">
          @for (skillGroup of nestedSkills$ | async; track skillGroup.id) {
          <li class="content__skills-groups-list-item">
            <app-skills-group
              [title]="skillGroup.name"
              [options]="skillGroup.skills"
              [selected]="stageForm.getRawValue().skills"
              [disabled]="isSkillGroupDisabled(skillGroup.name)"
              (groupToggled)="onSkillGroupToggled($event, skillGroup.name)"
              (optionToggled)="onOptionToggled($event)"
            ></app-skills-group>
          </li>
          }
        </ul>
      </div>
    </section>
  </div>

  <app-modal [open]="isChooseSkill()" (openChange)="isChooseSkill.set(!isChooseSkill())">
    <div class="cancel">
      <div class="cancel__top">
        <i (click)="isChooseSkill.set(false)" appIcon icon="cross" class="cancel__cross"></i>
        <p class="cancel__title text-bold-body-16">Произошла ошибка при заполнении данных!</p>
      </div>
      <p class="text-body-14 cancel__text">{{ isChooseSkillText() }}.</p>
    </div>
  </app-modal>
</div>
