<!-- @format -->

@if (vacancy()) {
<div class="vacancy">
  <div class="vacancy__split">
    <app-vacancies-left-side [vacancy]="vacancy"></app-vacancies-left-side>

    <app-vacancies-right-side
      [vacancy]="vacancy"
      (sendResponse)="onOpenResponseModal()"
    ></app-vacancies-right-side>
  </div>
</div>

<app-modal [(open)]="resultModal">
  <div class="succeed">
    <i class="succeed__check" appIcon icon="check" appWidth="60" appHeight="42"></i>
    <p class="text-body-12 succeed__text">отклик отправлен</p>
    <app-button routerLink="/office/vacancies/all" size="big" customTypographyClass="text-body-12"
      >перейти к вакансиям</app-button
    >
  </div>
</app-modal>

<app-modal [open]="openModal()" (openChange)="closeSendResponseModal()">
  <div class="cancel">
    <div class="lists__section">
      <p class="text-body-12 lists__title">отклик на вакансию</p>
      <i appIcon icon="squiz" class="lists__icon" appSquare="12"></i>
    </div>

    <form class="vacancy__form" [formGroup]="sendForm" (ngSubmit)="onSubmit()">
      @if (sendForm.get("whyMe"); as whyMe) {
      <fieldset>
        <label for="whyMe" class="field-label text-body-10">сопроводительное письмо</label>
        <app-textarea
          size="big"
          id="whyMe"
          formControlName="whyMe"
          [error]="whyMe | controlError"
          placeholder="Проект начал свое существование с 2020 года"
          [maxLength]="2000"
        ></app-textarea>
        @if (whyMe | controlError: "required") {
        <div class="text-body-10 error">
          {{ errorMessage.VALIDATION_REQUIRED }}
        </div>
        } @if (whyMe | controlError: "maxlength") {
        <div class="text-body-10 error">
          {{ errorMessage.VALIDATION_TOO_LONG }}
          @if (whyMe.errors) {
          {{ whyMe.errors["maxlength"]["requiredLength"] }}
          }
        </div>
        } @if (whyMe | controlError: "minlength") {
        <div class="text-body-10 error">
          {{ errorMessage.VALIDATION_TOO_SHORT }}
          @if (whyMe.errors) {
          {{ whyMe.errors["minlength"]["requiredLength"] }}
          }
        </div>
        }
      </fieldset>
      }

      <app-button
        [disabled]="true"
        style="opacity: 0.5"
        size="big"
        class="text-body-12"
        appearance="outline"
        >прикрепить резюме PROCOLLAB</app-button
      >

      <p class="vacancy__form--or text-body-12">или</p>

      @if (sendForm.get("accompanyingFile"); as accompanyingFile) {

      <div
        class="vacancy__form--cv"
        [class.vacancy__form-error]="accompanyingFile | controlError: 'required'"
      >
        <app-upload-file
          [error]="accompanyingFile | controlError"
          id="accompanyingFile"
          formControlName="accompanyingFile"
          accept=".pdf, .docx"
        >
          <ng-container emptyPlaceholder>
            <div class="vacancy__form--cv-empty">
              <i appIcon icon="file" appSquare="10"></i>
              <p class="text-body-12 vacancy__form--cv-text">
                файл резюме в формате <br />.pdf, .word весом до 50МБ
              </p>
            </div>
            @if (accompanyingFile | controlError: "required") {
            <p class="error text-body-10">загрузите файл</p>
            }
          </ng-container>
        </app-upload-file>
      </div>
      }

      <app-button size="big" (click)="onSubmit()" [loader]="sendFormIsSubmitting()" type="submit"
        >отправить отклик</app-button
      >
    </form>
  </div>
</app-modal>
}
