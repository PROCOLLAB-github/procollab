<!-- @format -->

<div class="auth register">
  <div class="auth__greeting">
    <h3 class="auth__title auth__title--register">
      @if (step === "credentials") {
      <ng-container>
        –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º –Ω–∞ Procollab!&nbsp;üëã<br />
        –°—Ç—Ä–æ–π —Å–≤–æ—é –∫–∞—Ä—å–µ—Ä—É —É–∂–µ —Å–µ–≥–æ–¥–Ω—è&nbsp;üöÄ
      </ng-container>
      } @else if (step === "info") {
      <ng-container>
        PROCOLLAB ‚Äî —Ç–≤–æ–π –ø—É—Ç—å –∫ –ø–µ—Ä–≤–æ–π —Ä–∞–±–æ—Ç–µ, –¥–∞–≤–∞–π –Ω–∞—á–Ω–µ–º —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–≤–æ–µ –ø–µ—Ä–≤–æ–µ —Ä–µ–∑—é–º–µ –ø—Ä—è–º–æ
        —Å–µ–π—á–∞—Å
      </ng-container>
      }
    </h3>
    <p class="auth__info">
      @if (step === "credentials") {
      <ng-container> –î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ </ng-container>
      } @else if (step === "info") {
      <ng-container>
        <!-- –ù–∞—á–Ω–∏ –∑–∞–ø–æ–ª–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º —Å—Ç–∞–Ω—É—Ç –æ—Å–Ω–æ–≤–æ–π —Ç–≤–æ–µ–≥–æ —Ä–µ–∑—é–º–µ -->
      </ng-container>
      }
    </p>
  </div>
  <form class="auth__wrapper" [formGroup]="registerForm" (ngSubmit)="onSubmit()">
    @if (step === "credentials") {
    <ng-container>
      @if (registerForm.get("email"); as email) {
      <fieldset class="auth__field">
        <label for="email" class="field-label">–ü–æ—á—Ç–∞</label>
        <app-input
          [error]="(email | controlError) && credsSubmitInitiated"
          id="email"
          type="email"
          formControlName="email"
          placeholder="mail@example.ru"
        ></app-input>
        @if (credsSubmitInitiated) {
        <ng-container>
          @if (email | controlError: "required") {
          <div class="text-body-14 error">
            {{ errorMessage.VALIDATION_REQUIRED }}
          </div>
          } @if (email | controlError: "email") {
          <div class="text-body-14 error">
            {{ errorMessage.VALIDATION_EMAIL }}
          </div>
          }
        </ng-container>
        }
      </fieldset>
      } @if (registerForm.get("password"); as password) {
      <fieldset class="auth__field">
        <label for="passowrd" class="field-label">–ü–∞—Ä–æ–ª—å</label>
        <app-input
          [error]="(password | controlError) && credsSubmitInitiated"
          id="passowrd"
          [type]="showPassword ? 'text' : 'password'"
          formControlName="password"
          placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å"
        >
          @if(showPassword) {
          <i
            appIcon
            icon="eye"
            appSquare="24"
            appWidth="24"
            appHeight="24"
            appViewBox="0 0 24 24"
            class="icon"
            (click)="toggleShowPassword('first')"
          ></i>
          } @else {
          <i
            appIcon
            icon="eye-off"
            appSquare="24"
            appWidth="24"
            appHeight="24"
            appViewBox="0 0 24 24"
            class="icon"
            (click)="toggleShowPassword('first')"
          ></i>
          }
        </app-input>
        <app-input
          class="register__repeated-password"
          [error]="(password | controlError) && credsSubmitInitiated"
          id="repeatedPassword"
          [type]="showPasswordRepeat ? 'text' : 'password'"
          formControlName="repeatedPassword"
          placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
        >
          @if(showPasswordRepeat) {
          <i
            appIcon
            icon="eye"
            appSquare="24"
            appWidth="24"
            appHeight="24"
            appViewBox="0 0 24 24"
            class="icon"
            (click)="toggleShowPassword('repeat')"
          ></i>
          } @else {
          <i
            appIcon
            icon="eye-off"
            appSquare="24"
            appWidth="24"
            appHeight="24"
            appViewBox="0 0 24 24"
            class="icon"
            (click)="toggleShowPassword('repeat')"
          ></i>
          }
        </app-input>
        @if (credsSubmitInitiated) {
        <ng-container>
          @if (password | controlError: "required") {
          <div class="text-body-14 error">
            {{ errorMessage.VALIDATION_REQUIRED }}
          </div>
          } @if (password | controlError: "passwordTooShort") {
          <div class="text-body-14 error">
            @if (password.errors) { –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º
            {{ password.errors["passwordTooShort"]["requiredLength"] }} —Å–∏–º–≤–æ–ª–æ–≤ }
          </div>
          } @if (password | controlError: "passwordNoUppercase") {
          <div class="text-body-14 error">
            –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º –æ–¥–Ω—É –∑–∞–≥–ª–∞–≤–Ω—É—é –±—É–∫–≤—É (A-Z)
          </div>
          } @if (password | controlError: "passwordNoLowercase") {
          <div class="text-body-14 error">
            –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º –æ–¥–Ω—É —Å—Ç—Ä–æ—á–Ω—É—é –±—É–∫–≤—É (a-z)
          </div>
          } @if (password | controlError: "passwordNoNumber") {
          <div class="text-body-14 error">–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º –æ–¥–Ω—É —Ü–∏—Ñ—Ä—É (0-9)</div>
          } @if (password | controlError: "passwordNoSpecialChar") {
          <div class="text-body-14 error">
            –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º –æ–¥–∏–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª
          </div>
          } @if (password | controlError: "passwordHasSpaces") {
          <div class="text-body-14 error">–ü–∞—Ä–æ–ª—å –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–±–µ–ª—ã</div>
          } @if (password | controlError: "passwordHasSequence") {
          <div class="text-body-14 error">
            –ü–∞—Ä–æ–ª—å –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∏–º–≤–æ–ª–æ–≤ (123456, abcdef –∏ —Ç.–¥.)
          </div>
          } @if (password | controlError: "passwordHasRepeating") {
          <div class="text-body-14 error">
            –ü–∞—Ä–æ–ª—å –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –±–æ–ª–µ–µ 2 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –ø–æ–¥—Ä—è–¥
          </div>
          } @if (password | controlError: "unMatch") {
          <div class="text-body-14 error">
            {{ errorMessage.VALIDATION_PASSWORD_UNMATCH }}
          </div>
          }
        </ng-container>
        }
      </fieldset>
      }
    </ng-container>
    } @else if (step === "info") {
    <ng-container>
      <div class="auth__row">
        @if (registerForm.get("firstName"); as name) {
        <fieldset class="auth__field">
          <label for="name" class="field-label">–ò–º—è</label>
          <app-input
            [error]="(name | controlError) && infoSubmitInitiated"
            id="name"
            type="text"
            formControlName="firstName"
            placeholder="–ò–≤–∞–Ω"
          ></app-input>
          @if (infoSubmitInitiated) {
          <ng-container>
            @if (name | controlError: "required") {
            <div class="text-body-14 error">
              {{ errorMessage.VALIDATION_REQUIRED }}
            </div>
            } @if (name | controlError: "invalidLanguage") {
            <div class="text-body-14 error">
              {{ errorMessage.VALIDATION_LANGUAGE }}
            </div>
            }
          </ng-container>
          }
        </fieldset>
        } @if (registerForm.get("lastName"); as surname) {
        <fieldset class="auth__field">
          <label for="surname" class="field-label">–§–∞–º–∏–ª–∏—è</label>
          <app-input
            [error]="(surname | controlError) && infoSubmitInitiated"
            id="surname"
            type="text"
            formControlName="lastName"
            placeholder="–ò–≤–∞–Ω–æ–≤"
          ></app-input>
          @if (infoSubmitInitiated) {
          <ng-container>
            @if (surname | controlError: "required") {
            <div class="text-body-14 error">
              {{ errorMessage.VALIDATION_REQUIRED }}
            </div>
            } @if (surname | controlError: "invalidLanguage") {
            <div class="text-body-14 error">
              {{ errorMessage.VALIDATION_LANGUAGE }}
            </div>
            }
          </ng-container>
          }
        </fieldset>
        }
      </div>
      @if (registerForm.get("birthday"); as birthday) {
      <fieldset class="auth__field">
        <label for="birthday" class="field-label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
        <app-input
          id="birthday"
          [error]="(birthday | controlError) && infoSubmitInitiated"
          type="text"
          mask="00.00.0000"
          placeholder="–î–î.–ú–ú.–ì–ì–ì–ì"
          formControlName="birthday"
        ></app-input>
        @if (infoSubmitInitiated) {
        <ng-container>
          @if (birthday | controlError: "required") {
          <div class="text-body-14 error">
            {{ errorMessage.VALIDATION_REQUIRED }}
          </div>
          } @if (birthday | controlError: "tooYoung") {
          <div class="text-body-14 error">
            @if (birthday.errors) {
            {{ errorMessage.MINIMAL_AGE }}
            {{ birthday.errors["tooYoung"]["requiredAge"] }} –ª–µ—Ç }
          </div>
          } @if (birthday | controlError: "tooOld") {
          <div class="text-body-14 error">
            @if (birthday.errors) {
            {{ errorMessage.MAXIMAL_AGE }}
            {{ birthday.errors["tooOld"]["requiredAge"] }} –ª–µ—Ç }
          </div>
          } @if (birthday | controlError: "invalidDateFormat") {
          <div class="text-body-14 error">
            {{ errorMessage.INVALID_DATE }}
          </div>
          }
        </ng-container>
        }
      </fieldset>
      }
    </ng-container>
    } @if (serverErrors) {
    <div class="text-body-14 error">
      @for (e of serverErrors; track $index) {
      <p>{{ e }}</p>
      }
    </div>
    } @if (step === "credentials") {
    <div class="register__agreement">
      <app-checkbox [(checked)]="registerAgreement"></app-checkbox>
      <span (click)="registerAgreement = !registerAgreement">
        –Ø –ø—Ä–æ—á–∏—Ç–∞–ª
        <a href="/assets/downloads/auth/shared/–ü–æ–ª–∏—Ç–∏–∫–∞_–æ–±—Ä–∞–±–æ—Ç–∫–∏_–ø–µ—Ä—Å_–¥–∞–Ω–Ω—ã—Ö_2022.docx" download>
          —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ
        </a>
        –∏ –¥–∞—é —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞&nbsp;–æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö&nbsp;–¥–∞–Ω–Ω—ã—Ö
      </span>
    </div>

    <div class="register__agreement">
      <app-checkbox [(checked)]="ageAgreement"></app-checkbox>
      <span (click)="ageAgreement = !ageAgreement"
        >–ù–∞–∂–∏–º–∞—è –Ω–∞ –∫–Ω–æ–ø–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ, —á—Ç–æ –≤–∞–º –±–æ–ª—å—à–µ 14 –ª–µ—Ç</span
      >
    </div>
    <app-button
      type="submit"
      class="auth__button"
      [disabled]="!(ageAgreement && registerAgreement)"
      [ngStyle]="{
        opacity: !(ageAgreement && registerAgreement) ? '0.6' : '1',
        cursor: !(ageAgreement && registerAgreement) ? 'not-allowed' : 'pointer'
      }"
      customTypographyClass="auth__button-typography"
    >
      –î–∞–ª–µ–µ
    </app-button>
    } @else if (step === "info") {
    <app-button [loader]="registerIsSubmitting" type="submit" class="auth__button">
      –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç
    </app-button>
    }
    <p class="auth__toggle">–ï—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a routerLink="/auth/login">–í–æ–π–¥–∏—Ç–µ</a></p>

    <app-modal
      [open]="isUserCreationModalError"
      (openChange)="isUserCreationModalError = !isUserCreationModalError"
    >
      <div class="cancel">
        <i
          (click)="isUserCreationModalError = !isUserCreationModalError"
          appIcon
          icon="cross"
          class="register__cross"
        ></i>

        <p class="register__title">–ü—Ä–∏–≤–µ—Ç!</p>

        <p class="text-body-14 register__text">
          –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é, –ø—Ä–æ—Ü–µ—Å—Å –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–æ
          6 —á–∞—Å–æ–≤.
        </p>

        <p class="text-body-14 register__text">
          –ö–∞–∫ —Ç–æ–ª—å–∫–æ —Ç–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç –±—É–¥–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω, —Ç—ã –ø–æ–ª—É—á–∏—à—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ –ø–æ—á—Ç—É.
        </p>

        <p class="text-body-14 register__text">
          –ú—ã —É–∂–µ —Ä–µ—à–∞–µ–º —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∫–æ–º—Ñ–æ—Ä—Ç–Ω—ã–º
          –¥–ª—è —Ç–µ–±—è ‚ù§Ô∏è
          <br />
          <br />
          –ü–æ –ª—é–±—ã–º –≤–æ–ø—Ä–æ—Å–∞–º –ø–∏—à–∏ –≤
          <a href="https://t.me/procollab_support">–∞–∫–∫–∞—É–Ω—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤ Telegram</a>
        </p>
      </div>
    </app-modal>
  </form>
</div>
