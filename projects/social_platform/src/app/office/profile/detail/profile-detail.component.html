<!-- @format -->

<div class="detail">
  <section class="detail__bar">
    <app-back path="/office/members/"></app-back>
  </section>

  <section class="detail__body">
    @if (user) {
    <div class="info profile__section profile__info">
      <div class="info__cover">
        <img class="info__cover" src="/assets/images/office/profile/detail/cover.png" alt="cover" />

        <div class="info__avatar">
          @if (chatService.userOnlineStatusCache | async; as cache) {
          <app-avatar
            [url]="user.avatar"
            [progress]="user.progress"
            [size]="110"
            [hasBorder]="true"
            [onlineBadgeSize]="15"
            [onlineBadgeBorder]="0"
            [onlineBadgeOffset]="8"
            [isOnline]="cache[user.id] !== undefined ? cache[user.id] : user.isOnline"
          ></app-avatar>
          <h2 class="info__title text-body-12">{{ user.firstName }} {{ user.lastName }}</h2>
          }
        </div>
      </div>
      <section class="info__body">
        <div class="info__actions">
          @if (authService.profile | async; as profile) { @if (profile.id !== user.id) {
          <a
            class="info__send-message"
            [routerLink]="['/office/chats', profile.id + '_' + user.id]"
          >
            <app-button size="medium" customTypographyClass="text-body-12"> Написать </app-button>
          </a>
          } @else {
          <div class="profile__btns">
            <a class="profile__cv">
              @if(isSubscriptionActive()){
              <app-button
                (click)="sendCVEmail()"
                customTypographyClass="text-body-12"
                color="primary"
              >
                Скачать CV
              </app-button>
              }
            </a>

            <a
              class="profile__edit"
              routerLink="/office/profile/edit"
              [queryParams]="{ editingStep: 'main' }"
            >
              <app-button size="medium" customTypographyClass="text-body-12">
                {{
                  user.progress! === 100 ? "Редактировать профиль" : "Закончить заполнение резюме"
                }}
                @if (user.progress !== 100) {
                <i
                  appIcon
                  icon="accent-error"
                  appSquare="16"
                  (mouseenter)="showTooltip()"
                  (mouseleave)="hideTooltip()"
                  style="color: var(--accent); margin-left: 5px"
                ></i>
                <span
                  class="profile__tooltip text-body-12"
                  [class.profile__tooltip--visible]="isHintVisible"
                  >{{ tooltipText }}</span
                >
                }
              </app-button>
            </a>
          </div>
          } }
        </div>
      </section>
    </div>

    @if (authService.profile | async; as profile;) { @if (profile.id === user.id) {
    <app-modal [open]="isProfileFill" (openChange)="isProfileFill = !isProfileFill">
      <div class="cancel">
        <img
          alt="profile unfill image"
          class="cancel__image"
          src="/assets/images/profile/profile-unfill.png"
        />
        <div class="cancel__top">
          <i (click)="isProfileFill = false" appIcon icon="cross" class="cancel__cross"></i>
          <p class="cancel__title text-body-12">
            Заполни все поля, чтобы использовать Procollab на максимум
          </p>
        </div>
        <p class="text-body-12 cancel__text">Заполни все поля, чтобы иметь сильное резюме</p>

        <a routerLink="/office/profile/edit" [queryParams]="{ editingStep: 'main' }">
          <app-button size="big" customTypographyClass="text-body-12"
            >Продолжить заполнение</app-button
          >
        </a>
      </div>
    </app-modal>
    } } }

    <app-modal [open]="isDelayModalOpen" (openChange)="isDelayModalOpen = !isDelayModalOpen">
      <div class="cancel">
        <div class="cancel__top">
          <i (click)="isDelayModalOpen = false" appIcon icon="cross" class="cancel__cross"></i>
          <p class="cancel__title text-bold-body-16">Повторите загрузку позже</p>
        </div>
        <p class="text-body-14 cancel__text">
          Скачивание будет доступно через {{ errorMessageModal() }} секунд.
        </p>
      </div>
    </app-modal>

    <app-modal [open]="isSended" (openChange)="isSended = !isSended">
      <div class="cancel">
        <div class="cancel__top">
          <i (click)="isSended = false" appIcon icon="cross" class="cancel__cross"></i>
          <p class="cancel__title text-bold-body-16">Твое CV уже ждет тебя на почте :)</p>
        </div>
        <p class="text-body-14 cancel__text">
          Кстати, оно часто залетает в папку «Спам» — обязательно проверь и там тоже.<br />
          Технические сложности? Мы всегда на связи в Telegram — {{ "@procollab_support" }}
        </p>
      </div>
    </app-modal>

    <router-outlet></router-outlet>
  </section>
</div>
