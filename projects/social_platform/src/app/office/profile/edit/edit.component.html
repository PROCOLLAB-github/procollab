<!-- @format -->

@if (profileForm.get("userType"); as currentType) {
<div class="profile__top">
  <div class="profile__back" [routerLink]="'/office/profile/' + profileId">
    <i appIcon icon="left-arrow" appSquare="24"></i>
    <h1 class="profile__title">редактирование профиля</h1>
  </div>

  <div appEditorSubmitButton containerSelector=".profile" class="profile__save">
    <app-button
      size="medium"
      [disabled]="
        editEducationClick ||
        editWorkClick ||
        editLanguageClick ||
        isEducationDirty ||
        isWorkDirty ||
        isLanguageDirty ||
        isAchievementsDirty
      "
      [loader]="profileFormSubmitting"
      [ngStyle]="{
        opacity:
          editEducationClick ||
          editWorkClick ||
          editLanguageClick ||
          isEducationDirty ||
          isWorkDirty ||
          isLanguageDirty ||
          isAchievementsDirty
            ? '0.6'
            : '1',
        cursor:
          editEducationClick ||
          editWorkClick ||
          editLanguageClick ||
          isEducationDirty ||
          isWorkDirty ||
          isLanguageDirty ||
          isAchievementsDirty
            ? 'not-allowed'
            : 'pointer'
      }"
      customTypographyClass="text-body-12"
      (click)="saveProfile()"
    >
      cохранить</app-button
    >
  </div>
</div>

<main class="profile">
  <form [formGroup]="profileForm" (ngSubmit)="saveProfile()" class="profile__form">
    <div class="profile__navigation">
      <ul class="profile__nav">
        @for (item of navProfileItems; track $index) {
        <li
          class="profile__item"
          [class.profile__item--active]="editingStep === item.step"
          (click)="navigateStep(item.step)"
        >
          <i
            appIcon
            [icon]="item.src"
            class="profile__icon"
            appSquare="14"
            [class.profile__icon--active]="editingStep === item.step"
            alt="project-icon"
          ></i>
          <p
            class="profile__subtitle"
            [class.profile__subtitle--active]="editingStep === item.step"
          >
            {{ item.label }}
          </p>
        </li>
        }
      </ul>
    </div>

    <div class="profile__wrapper">
      @if(editingStep === 'main'){
      <div class="profile__wrapper--main">
        <div class="profile__row">
          @if (profileForm.get("avatar"); as avatar) {
          <div>
            <label for="avatar" class="field-label" style="text-align: center">фото</label>
            <fieldset class="profile__avatar">
              <app-avatar-control
                id="avatar"
                formControlName="avatar"
                type="profile"
                [size]="68"
                [error]="avatar | controlError"
              ></app-avatar-control>
              @if (avatar | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.EMPTY_AVATAR }}
              </div>
              }
            </fieldset>
          </div>
          } @if (profileForm.get("coverImageAddress"); as coverImageAddress) {
          <fieldset class="profile__file">
            <label
              class="field-label text-body-12"
              for="coverImageAddress"
              style="text-align: center"
              >обложка для профиля</label
            >
            <app-upload-file
              formControlName="coverImageAddress"
              accept=".jpg,.png,.jpeg"
              [error]="coverImageAddress | controlError"
            >
              <ng-container emptyPlaceholder>
                <i appIcon icon="file" appSquare="16"></i>
                <p class="text-body-12 profile__slides-text">
                  обложка формата
                  <br />
                  .JPG или .JPEG весом до 50МБ
                </p>
                @if (coverImageAddress | controlError: "required") {
                <p class="profile__slides-error text-body-10">загрузите файл</p>
                }
              </ng-container>
            </app-upload-file>
          </fieldset>
          }
        </div>

        <div class="profile__main--grid">
          <div class="profile__column">
            @if (profileForm.get("firstName"); as firstName) {
            <fieldset>
              <label for="firstName" class="field-label">имя</label>
              <app-input
                size="big"
                [error]="firstName | controlError"
                id="firstName"
                type="text"
                formControlName="firstName"
                placeholder="иван"
              ></app-input>
              @if (firstName | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            } @if (profileForm.get("lastName"); as lastName) {
            <fieldset>
              <label for="lastName" class="field-label">фамилия</label>
              <app-input
                size="big"
                [error]="lastName | controlError"
                id="lastName"
                type="text"
                formControlName="lastName"
                placeholder="иванов"
              ></app-input>
              @if (lastName | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            }
          </div>

          <div class="profile__column">
            @if (profileForm.get("city"); as city) {
            <fieldset>
              <label for="city" class="field-label">город</label>
              <app-input
                size="big"
                id="city"
                [error]="city | controlError"
                type="text"
                placeholder="москва"
                formControlName="city"
                [maxLength]="100"
              ></app-input>
              @if (city | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            } @if (profileForm.get("birthday"); as birthday) {
            <fieldset class="space">
              <label for="birthday" class="field-label">дата рождения</label>
              <app-input
                size="big"
                id="birthday"
                [error]="birthday | controlError"
                type="text"
                mask="00.00.0000"
                formControlName="birthday"
              ></app-input>
              @if (birthday | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            }
          </div>

          <div class="profile__column">
            @if (profileForm.get("userType"); as userType) { @if (userType.value !== 1) {
            <fieldset>
              <label for="userType" class="field-label">тип аккаунта</label>
              @if (roles | async; as options) {
              <app-select
                size="big"
                id="userType"
                formControlName="userType"
                placeholder="эксперт"
                [options]="options"
              ></app-select>
              } @if (userType | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            } } @if (profileForm.get("speciality"); as speciality) {
            <fieldset>
              <label for="speciality" class="field-label">специальность</label>
              <div class="profile__vacancies">
                <app-autocomplete-input
                  class="profile__vacancies--input"
                  searchIcon="box"
                  [suggestions]="inlineSpecs()"
                  fieldToDisplay="name"
                  valueField="name"
                  fieldToDisplay="name"
                  [forceSelect]="true"
                  [error]="speciality | controlError"
                  (searchStart)="onSearchSpec($event)"
                  placeholder="java developer"
                  formControlName="speciality"
                  (openSkillsFunc)="toggleSpecsGroupsModal()"
                ></app-autocomplete-input>
              </div>
              @if (speciality | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            }
          </div>
        </div>

        <div class="profile__column">
          @if (profileForm.get("aboutMe"); as aboutMe) {
          <fieldset>
            <label for="aboutMe" class="field-label">обо мне</label>
            <app-textarea
              size="big"
              id="aboutMe"
              [error]="aboutMe | controlError"
              type="text"
              placeholder="я java developer, очень люблю котиков"
              formControlName="aboutMe"
              [maxLength]="300"
            ></app-textarea>
            @if (aboutMe | controlError: "required") {
            <div class="text-body-10 error">
              {{ errorMessage.VALIDATION_REQUIRED }}
            </div>
            }
          </fieldset>
          }
        </div>

        <div class="profile__wrapper--links">
          <div class="profile__column">
            <fieldset>
              <label for="links" class="field-label">указать личные контакты</label>
              <div class="profile__row" style="flex-grow: 1">
                <ul
                  formArrayName="links"
                  style="width: 100%"
                  [class.profile__row]="links.controls.length === 1"
                  [class.profile__column]="links.controls.length > 1"
                >
                  @for (control of links.controls; let i = $index; track i) {
                  <li class="profile__row">
                    <app-input
                      style="flex-grow: 1"
                      [formControlName]="i"
                      placeholder="@eeeasycarrer"
                      size="big"
                      [error]="control | controlError"
                    ></app-input>

                    <app-button type="icon" color="red" (click)="removeLink(i)">
                      <i appIcon icon="basket" appSquare="14"></i>
                    </app-button>
                  </li>
                  }
                </ul>
              </div>
            </fieldset>

            <app-button
              size="big"
              customTypographyClass="text-body-12"
              appearance="outline"
              (click)="addLink()"
            >
              <span> добавить контакт </span>
              <i appIcon icon="plus" appSquare="6"></i>
            </app-button>
          </div>

          <div class="profile__column">
            @if (profileForm.get("phoneNumber"); as phoneNumber) {
            <fieldset>
              <label for="links" class="field-label">телефон</label>
              <app-input
                size="big"
                id="phoneNumber"
                mask="0-000-000-00-00"
                [error]="phoneNumber | controlError"
                type="text"
                placeholder="+79030195823"
                formControlName="phoneNumber"
                style="flex-grow: 1"
              ></app-input>
              @if (phoneNumber | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            }
          </div>
        </div>
      </div>
      } @if (editingStep === 'education') {
      <div class="profile__wrapper--education">
        <div class="profile__column">
          @if (showEducationFields) {
          <div class="profile__column--date">
            @if (profileForm.get("entryYear"); as entryYear) {
            <fieldset>
              <label for="entryYear" class="field-label">начало</label>
              <app-select
                size="big"
                [selectedId]="selectedEntryYearEducationId()"
                formControlName="entryYear"
                placeholder="2023 год"
                [options]="yearListEducation"
              >
                <i appIcon icon="arrow-no-body" appSquare="32"></i>
              </app-select>

              @if (entryYear | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            } @if (profileForm.get("completionYear"); as completionYear) {
            <fieldset>
              <label for="completionYear" class="field-label">конец</label>
              <app-select
                size="big"
                [selectedId]="selectedComplitionYearEducationId()"
                formControlName="completionYear"
                placeholder="2023 год"
                [options]="yearListEducation"
              >
                <i appIcon icon="arrow-no-body" appSquare="32"></i>
              </app-select>
              @if (completionYear | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            }
          </div>

          <div class="profile__column">
            @if (profileForm.get("organizationName"); as organizationName) {
            <fieldset>
              <label for="organizationName" class="field-label">название учереждения</label>
              <app-input
                size="big"
                [error]="organizationName | controlError"
                placeholder="вуз / колледж / школа"
                formControlName="organizationName"
                [maxLength]="100"
              ></app-input>
              @if (organizationName | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            }
          </div>

          <div class="profile__column">
            @if (profileForm.get("description"); as description) {
            <fieldset>
              <label for="description" class="field-label">направление</label>
              <app-input
                size="big"
                [error]="description | controlError"
                placeholder="бизнес информатика"
                formControlName="description"
                [maxLength]="400"
              ></app-input>
              @if (description | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            }
          </div>

          <div class="profile__column">
            @if (profileForm.get("educationLevel"); as educationLevel) {
            <fieldset>
              <label for="educationLevel" class="field-label">уровень образования</label>
              <app-select
                size="big"
                [selectedId]="selectedEducationLevelId()"
                formControlName="educationLevel"
                placeholder="высшее образование-магистратура"
                [options]="educationLevelList"
              >
                <i appIcon icon="arrow-no-body" appSquare="32"></i>
              </app-select>
              @if (educationLevel | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            }
          </div>

          <div class="profile__column">
            @if (profileForm.get("educationStatus"); as educationStatus) {
            <fieldset>
              <label for="educationStatus" class="field-label">статус</label>
              <app-select
                size="big"
                [selectedId]="selectedEducationStatusId()"
                formControlName="educationStatus"
                placeholder="студент"
                [options]="educationStatusList"
              >
                <i appIcon icon="arrow-no-body" appSquare="32"></i>
              </app-select>
              @if (educationStatus | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            }
          </div>
          }

          <app-button
            customTypographyClass="text-body-12"
            size="big"
            appearance="outline"
            [disabled]="showEducationFields && !isEducationDirty"
            [ngStyle]="{
              opacity: showEducationFields && !isEducationDirty ? '0.6' : '1',
              cursor: showEducationFields && !isEducationDirty ? 'not-allowed' : 'pointer'
            }"
            class="profile__add-education"
            (click)="addEducation()"
          >
            <span>{{ editEducationClick ? "сохранить изменения" : "добавить образование" }}</span>
            <i appIcon icon="plus" appSquare="6"></i>
          </app-button>
        </div>

        <div class="profile__education--list">
          @if(educationItems().length || education.length){ @for (educationItem of education.value;
          track $index) {
          <div class="profile__education--info">
            <p class="text-body-12 education__title">
              {{ educationItem.organizationName }}
            </p>

            <p class="text-body-10 education__text">
              @if(educationItem.entryYear && educationItem.completionYear) {
              {{ educationItem.entryYear }} год • {{ educationItem.completionYear }} год } @else if
              (educationItem.entryYear && !educationItem.completionYear) {
              {{ educationItem.entryYear }} год } @else if (!educationItem.entryYear &&
              educationItem.completionYear){ {{ educationItem.completionYear }} год }
            </p>

            <div class="profile__education--card">
              <div class="profile__education--info">
                <p class="text-body-10 education__text">
                  {{ educationItem.description }}
                </p>

                <p class="text-body-10 education__text">
                  {{ educationItem.educationLevel }}
                </p>

                <p class="text-body-10 education__text">
                  {{ educationItem.educationStatus }}
                </p>
              </div>

              <div class="profile__action--icons">
                <div class="edit-icon" (click)="editEducation($index)">
                  <i appIcon icon="edit-pen" appSquare="10"></i>
                </div>

                <div class="basket-icon" (click)="removeEducation($index)">
                  <i appIcon icon="basket" appSquare="10"></i>
                </div>
              </div>
            </div>
          </div>
          } }
        </div>
      </div>
      } @if (editingStep === 'experience') {
      <div class="profile__wrapper--education">
        <div class="profile__column">
          @if (showWorkFields){
          <div class="profile__column">
            <div class="profile__column--date">
              @if (profileForm.get("entryYearWork"); as entryYearWork) {
              <fieldset>
                <label for="entryYearWork" class="field-label">начало</label>
                <app-select
                  size="big"
                  [selectedId]="selectedEntryYearWorkId()"
                  formControlName="entryYearWork"
                  placeholder="2023 год"
                  [options]="yearListEducation"
                >
                  <i appIcon icon="arrow-no-body" appSquare="32" class="arrow-list__entry"></i>
                </app-select>

                @if (entryYearWork | controlError: "required") {
                <div class="text-body-10 error">
                  {{ errorMessage.VALIDATION_REQUIRED }}
                </div>
                }
              </fieldset>
              } @if (profileForm.get("completionYearWork"); as completionYearWork) {
              <fieldset>
                <label for="completionYearWork" class="field-label">конец</label>
                <app-select
                  size="big"
                  [selectedId]="selectedComplitionYearWorkId()"
                  formControlName="completionYearWork"
                  placeholder="2023 год"
                  [options]="yearListEducation"
                >
                  <i appIcon icon="arrow-no-body" appSquare="32" class="arrow-list__end"></i>
                </app-select>

                @if (completionYearWork | controlError: "required") {
                <div class="text-body-10 error">
                  {{ errorMessage.VALIDATION_REQUIRED }}
                </div>
                }
              </fieldset>
              }
            </div>
          </div>

          <div class="profile__column">
            @if (profileForm.get("organization"); as organization) {
            <fieldset>
              <label for="organization" class="field-label">организация</label>
              <app-input
                size="big"
                id="organization"
                [error]="organization | controlError"
                type="text"
                placeholder="проколлаб"
                formControlName="organization"
                [maxLength]="50"
              ></app-input>
              @if (organization | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            }
          </div>

          <div class="profile__column">
            @if (profileForm.get("jobPosition"); as jobPosition) {
            <fieldset>
              <label for="jobPosition" class="field-label">должность</label>
              <app-input
                size="big"
                id="jobPosition"
                [error]="jobPosition | controlError"
                type="text"
                placeholder="дизайнер"
                formControlName="jobPosition"
              ></app-input>
              @if (jobPosition | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            }
          </div>

          <div class="profile__column">
            @if (profileForm.get("descriptionWork"); as descriptionWork) {
            <fieldset>
              <label for="descriptionWork" class="field-label">краткое описание</label>
              <app-textarea
                size="big"
                id="descriptionWork"
                [error]="descriptionWork | controlError"
                type="text"
                placeholder="работал с данными, разрабатывал интерфейсы."
                formControlName="descriptionWork"
                [maxLength]="400"
              ></app-textarea>
              @if (descriptionWork | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            }
          </div>
          }

          <app-button
            customTypographyClass="text-body-12"
            size="big"
            appearance="outline"
            [disabled]="showWorkFields && !isWorkDirty"
            [ngStyle]="{
              opacity: showWorkFields && !isWorkDirty ? '0.6' : '1',
              cursor: showWorkFields && !isWorkDirty ? 'not-allowed' : 'pointer'
            }"
            class="profile__add-education"
            (click)="addWork()"
          >
            <span>{{ editWorkClick ? "сохранить изменения" : "добавить работу" }}</span>
            <i appIcon icon="plus" appSquare="6"></i>
          </app-button>
        </div>

        <div class="profile__education--list">
          @if(workItems().length || workExperience.length){ @for (workItem of workExperience.value;
          track $index) {
          <div class="profile__education--info">
            <p class="text-body-12 education__title">
              {{ workItem.organizationName }}
            </p>

            <p class="text-body-10 education__text">
              @if(workItem.entryYear && workItem.completionYear) {
              {{ workItem.entryYear }} год • {{ workItem.completionYear }} год } @else if
              (workItem.entryYear && !workItem.completionYear) { {{ workItem.entryYear }} год }
              @else if (!workItem.entryYear && workItem.completionYear){
              {{ workItem.completionYear }} год }
            </p>

            <div class="profile__education--card">
              <div class="profile__education--info">
                <p class="text-body-10 education__text">
                  {{ workItem.description }}
                </p>

                <p class="text-body-10 education__text">
                  {{ workItem.jobPosition }}
                </p>
              </div>

              <div class="profile__action--icons">
                <div class="edit-icon" (click)="editWork($index)">
                  <i class="edit" appIcon icon="edit-pen" appSquare="10"></i>
                </div>

                <div class="basket-icon" (click)="removeWork($index)">
                  <i appIcon icon="basket" appSquare="10"></i>
                </div>
              </div>
            </div>
          </div>
          } }
        </div>
      </div>
      } @if(editingStep === 'achievements'){
      <div class="profile__wrapper--education">
        <div class="profile__column">
          @if (showAchievementsFields) {
          <div class="profile__column">
            @if (profileForm.get("title"); as title) {
            <fieldset>
              <label class="field-label">название достижения</label>
              <app-input
                size="big"
                [error]="title | controlError"
                placeholder="выиграли акселератор"
                formControlName="title"
              ></app-input>
              @if (title | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            }
          </div>

          <div class="profile__column">
            @if (profileForm.get("year"); as year) {
            <fieldset>
              <label class="field-label">год достижения</label>
              <app-select
                size="big"
                [error]="year | controlError"
                placeholder="2022"
                formControlName="year"
                [selectedId]="selectedAchievementsYearId()"
                [options]="achievementsYearList"
              ></app-select>
              @if (year | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            }
          </div>

          <div class="profile__column">
            @if (profileForm.get("status"); as status) {
            <fieldset>
              <label class="field-label">описание</label>
              <app-textarea
                size="big"
                [error]="status | controlError"
                placeholder="разработали прототип приложения для менторов в Московской области"
                formControlName="status"
              ></app-textarea>
              @if (status | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            }
          </div>

          <div class="profile__column">
            @if (profileForm.get("files"); as files) {
            <fieldset class="profile__file" style="max-width: 100%">
              <app-upload-file
                formControlName="files"
                accept=".jpg,.png,.jpeg,.pdf"
                [error]="files | controlError"
              >
                <ng-container emptyPlaceholder>
                  <i appIcon icon="file" appSquare="16"></i>
                  <p class="text-body-12 profile__slides-text">
                    файл или изображение <br />
                    с сертификатом подтверждающим <br />
                    достижение весом до 50МБ
                  </p>
                  @if (files | controlError: "required") {
                  <p class="profile__slides-error text-body-10">загрузите файл</p>
                  }
                </ng-container>
              </app-upload-file>
            </fieldset>
            }
          </div>
          }
          <app-button
            customTypographyClass="text-body-12"
            size="big"
            appearance="outline"
            [disabled]="showAchievementsFields && !isAchievementsDirty"
            [ngStyle]="{
              opacity: showAchievementsFields && !isAchievementsDirty ? '0.6' : '1',
              cursor: showAchievementsFields && !isAchievementsDirty ? 'not-allowed' : 'pointer'
            }"
            (click)="addAchievement()"
          >
            <span>{{ editAchievementsClick ? "сохранить изменения" : "добавить достижение" }}</span>
            <i appIcon icon="plus" appSquare="6"></i>
          </app-button>
        </div>

        <div class="profile__education--list">
          @if(achievementItems().length || achievements.length){ @for (achievementItem of
          achievements.value; track $index) {
          <div class="profile__education--info">
            <div class="profile__education--card" style="align-items: flex-end">
              <div class="profile__education--info">
                <p class="text-body-12 education__title">
                  {{ achievementItem.title }}
                </p>

                <p class="text-body-10 education__text" style="color: var(--grey-for-text)">
                  {{ achievementItem.year }}
                </p>

                <p class="text-body-10 education__text">
                  {{ achievementItem.status }}
                </p>

                @if (achievementItem.files?.length) { @if (isStringFiles(achievementItem.files)) {
                <app-file-item
                  type="file"
                  name="ваш файл"
                  [size]="0"
                  [link]="achievementItem.files"
                >
                </app-file-item>
                } @else { @for (file of achievementItem.files; track $index) {
                <app-file-item
                  [type]="file.mimeType"
                  [name]="file.name"
                  [size]="file.size"
                  [link]="file.link"
                >
                </app-file-item>
                } } }
              </div>

              <div class="profile__action--icons">
                <div class="edit-icon" (click)="editAchievements($index)">
                  <i class="edit" appIcon icon="edit-pen" appSquare="10"></i>
                </div>

                <div class="basket-icon" (click)="removeAchievement($index)">
                  <i appIcon icon="basket" appSquare="10"></i>
                </div>
              </div>
            </div>
          </div>
          } }
        </div>
      </div>
      } @if (editingStep === 'skills') {
      <div class="profile__wrapper--education">
        <div class="profile__column">
          <fieldset>
            <label for="skills" class="field-label">мои навыки</label>
            <div class="skills-field">
              <app-autocomplete-input
                class="skills-field__input"
                placeholder="python"
                searchIcon="box"
                [suggestions]="inlineSkills()"
                fieldToDisplay="name"
                [forceSelect]="true"
                [clearInputOnSelect]="true"
                (searchStart)="onSearchSkill($event)"
                (optionSelected)="onAddSkill($event)"
                (openSkillsFunc)="toggleSkillsGroupsModal()"
              ></app-autocomplete-input>
            </div>
          </fieldset>

          <div class="profile__column">
            @if (profileForm.get("skills"); as skills) {
            <fieldset class="skills-basket">
              <app-skills-basket
                formControlName="skills"
                [error]="skills | controlError"
              ></app-skills-basket>
            </fieldset>
            }
          </div>
        </div>

        <div class="profile__column">
          @if (showLanguageFields) {
          <div class="profile__column--date">
            @if (profileForm.get("language"); as language) {
            <fieldset>
              <label for="languageName" class="field-label">язык</label>
              <app-select
                size="big"
                [selectedId]="selectedLanguageId()"
                formControlName="language"
                placeholder="английский"
                [options]="languageList"
              >
                <i appIcon icon="arrow-no-body" appSquare="32" class="arrow-list__end"></i>
              </app-select>

              @if (language | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            } @if (profileForm.get("languageLevel"); as languageLevel) {
            <fieldset>
              <label for="languagLevel" class="field-label">уровень</label>
              <app-select
                size="big"
                [selectedId]="selectedLanguageLevelId()"
                formControlName="languageLevel"
                placeholder="B1"
                [options]="languageLevelList"
              >
                <i appIcon icon="arrow-no-body" appSquare="32" class="arrow-list__end"></i>
              </app-select>

              @if (languageLevel | controlError: "required") {
              <div class="text-body-10 error">
                {{ errorMessage.VALIDATION_REQUIRED }}
              </div>
              }
            </fieldset>
            }
          </div>
          }

          <span class="text-body-10" style="color: var(--black)"
            >количество добавляемых языков не более 4-х</span
          >
          <app-button
            customTypographyClass="text-body-12"
            size="big"
            appearance="outline"
            [disabled]="
              showLanguageFields &&
              !isLanguageDirty &&
              (languageItems().length === 4 || userLanguages.length === 4)
            "
            [ngStyle]="{
                opacity: showLanguageFields && !isLanguageDirty ? '0.6' : '1',
                cursor: showLanguageFields && !isLanguageDirty ? 'not-allowed' : 'pointer',
              }"
            (click)="addLanguage()"
          >
            <span>{{ editLanguageClick ? "сохранить изменения" : "добавить язык" }}</span>
            <i appIcon icon="plus" appSquare="6"></i>
          </app-button>

          <div class="profile__language--list">
            @if(languageItems().length || userLanguages.length){ @for (languageItem of
            userLanguages.value; track $index) {
            <div class="profile__education--info">
              <div class="education__title">
                <p class="text-body-12">
                  {{ languageItem.language }}
                </p>

                <div class="profile__action--icons" style="flex-direction: row">
                  <div class="edit-icon" (click)="editLanguage($index)">
                    <i appIcon icon="edit-pen" appSquare="10"></i>
                  </div>

                  <div class="basket-icon" (click)="removeLanguage($index)">
                    <i appIcon icon="basket" appSquare="10"></i>
                  </div>
                </div>
              </div>

              <p class="text-body-10 education__text" style="margin-top: 5px">
                {{ languageItem.languageLevel }}
              </p>
            </div>
            } }
          </div>
        </div>
      </div>
      } @else if (editingStep === 'settings') {
      <div class="profile__wrapper--settings">
        <app-button
          (click)="isModalDeleteProfile.set(true)"
          customTypographyClass="text-body-12"
          color="red"
          size="big"
          >удалить профиль</app-button
        >
      </div>
      }
    </div>
  </form>
</main>
}

<app-modal
  [open]="isModalErrorSkillsChoose()"
  (openChange)="isModalErrorSkillsChoose.set(!isModalErrorSkillsChoose())"
>
  <div class="cancel">
    <div class="cancel__top">
      <i
        (click)="isModalErrorSkillsChoose.set(false)"
        appIcon
        appSquare="10"
        icon="cross"
        class="cancel__cross"
      ></i>
      <p class="cancel__title text-body-14">произошла ошибка при редактировании!</p>
    </div>
    @if (isModalErrorSkillChooseText()) {
    <p class="text-body-12 cancel__text">{{ isModalErrorSkillChooseText() }}.</p>
    } @else {
    <p class="text-body-12 cancel__text">
      для публикации профиля, нужно заполнить все <strong>обязательные поля</strong> (они будут
      <strong>подсвечены&nbsp;<span>красным</span></strong
      >).
    </p>
    }
  </div>
</app-modal>

<app-modal
  [open]="isModalDeleteProfile()"
  (openChange)="isModalDeleteProfile.set(!isModalDeleteProfile())"
>
  <div class="cancel">
    <div class="cancel__top">
      <p class="cancel__title text-body-14">подтвердите удаление аккаунта</p>
      <i appIcon icon="sad-smile" appSquare="50" class="cancel__delete-icon"></i>
    </div>

    <app-button customTypographyClass="text-body-12" size="big" color="red"
      >удалить аккаунт</app-button
    >
  </div>
</app-modal>

<app-modal
  [open]="specsGroupsModalOpen()"
  (openChange)="specsGroupsModalOpen.set(!specsGroupsModalOpen())"
  class="modal"
>
  <div class="modal__wrapper">
    <h4 class="text-heading-4">более специальностей</h4>
    <div class="modal__content">
      <div class="modal__specs-groups">
        <ul>
          @for (specsGroup of (nestedSpecs$ | async)?.slice(0, 7); track specsGroup.id) {
          <li>
            <app-specializations-group
              [title]="specsGroup.name"
              [options]="specsGroup.specializations"
              [hasOpenGroups]="hasOpenSpecializationsGroups()"
              [disabled]="isSpecializationGroupDisabled(specsGroup.name)"
              (groupToggled)="onSpecializationsGroupToggled($event, specsGroup.name)"
              (selectOption)="onSelectSpec($event)"
            ></app-specializations-group>
          </li>
          }
        </ul>
      </div>
    </div>
    <app-button
      customTypographyClass="text-body-12"
      size="medium"
      (click)="toggleSpecsGroupsModal()"
      >сохранить</app-button
    >
  </div>
</app-modal>

<app-modal [open]="skillsGroupsModalOpen()" class="modal">
  <div class="modal__wrapper">
    <h4 class="text-heading-4">библиотека навыков</h4>
    <div class="modal__content">
      <div class="modal__skills-groups">
        <ul>
          @for (skillsGroup of nestedSkills$ | async; track skillsGroup.id) {
          <li>
            <app-skills-group
              [title]="skillsGroup.name"
              [options]="skillsGroup.skills"
              [selected]="this.profileForm.getRawValue().skills"
              [disabled]="isGroupDisabled(skillsGroup.id)"
              [hasOpenGroups]="openGroupIndex !== null"
              (optionToggled)="onToggleSkill($event)"
              (groupToggled)="onGroupToggled(skillsGroup.id, $event)"
            ></app-skills-group>
          </li>
          }
        </ul>
      </div>
    </div>
    <app-button
      customTypographyClass="text-body-12"
      size="medium"
      (click)="toggleSkillsGroupsModal()"
      >Сохранить</app-button
    >
  </div>
</app-modal>
