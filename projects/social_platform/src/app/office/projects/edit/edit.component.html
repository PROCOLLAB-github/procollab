<!-- @format -->
<div>
  <div class="project__top">
    <p class="project__title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</p>
    <a class="project__back" [routerLink]="'/office/projects/' + profileId">
      <app-button [color]="'grey'" customTypographyClass="text-body-12">–ù–∞–∑–∞–¥</app-button>
    </a>
  </div>
  <main class="project">
    <form [formGroup]="projectForm" class="project__form">
      <app-project-navigation
        style="width: 100%"
        (stepChange)="navigateStep($event)"
      ></app-project-navigation>

      <div class="project__inner">
        @if (editingStep === "main") {
        <app-project-main-step
          style="width: 100%"
          [industries$]="industries$"
          [projectSteps$]="projectSteps$"
          [programTagsOptions]="programTagsOptions"
          [leaderId]="leaderId"
          [projSubmitInitiated]="projSubmitInitiated"
          [isProjectBoundToProgram]="isProjectBoundToProgram"
          (assignToProgram)="assignProjectToProgram()"
        ></app-project-main-step>

        } @else if (editingStep === "contacts") {
        <app-project-contacts-step style="width: 100%"></app-project-contacts-step>
        } @else if (editingStep === "achievements") {
        <app-project-achievement-step
          style="width: 100%"
          [projSubmitInitiated]="projSubmitInitiated"
        ></app-project-achievement-step>
        } @else if (editingStep === "vacancies"){
        <app-project-vacancy-step
          style="width: 100%"
          [inlineSkills]="inlineSkills()"
          (searchSkill)="onSearchSkill($event)"
          (addSkill)="onAddSkill($event)"
          (removeSkill)="onRemoveSkill($event)"
          (toggleSkillsGroupsModal)="toggleSkillsGroupsModal()"
        ></app-project-vacancy-step>
        } @else if (editingStep === "team") {
        <app-project-team-step style="width: 100%"></app-project-team-step>
        } @else if (editingStep === "additional") {
        <app-project-additional-step
          #additionalStepComponent
          style="width: 100%"
          [programTagsOptions]="programTagsOptions"
        ></app-project-additional-step>
        }
      </div>
      <div class="project__save">
        <app-button customTypographyClass="text-body-12" color="red" (click)="deleteProject()">
          –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
        </app-button>
        <app-button
          customTypographyClass="text-body-12"
          color="grey"
          [loader]="projFormIsSubmittingAsDraft"
          (click)="saveProjectAsDraft()"
        >
          –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫
        </app-button>
        <app-button
          customTypographyClass="text-body-12"
          [loader]="projFormIsSubmittingAsPublished"
          (click)="saveProjectAsPublished()"
        >
          {{ isCompetitive ? "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É" : "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" }}
        </app-button>
      </div>
    </form>
    <app-modal
      [open]="
        (projectForm.invalid || additionalForm.invalid) && projSubmitInitiated && !warningModalSeen
      "
    >
      <div class="project__warning-modal">
        <h3 class="text-bold-body-16">üì¢ –í–Ω–∏–º–∞–Ω–∏–µ!</h3>
        <p class="text-body-14">
          –î–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞, –Ω—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ <strong>–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è</strong> (–æ–Ω–∏ –±—É–¥—É—Ç
          <strong>–ø–æ–¥—Å–≤–µ—á–µ–Ω—ã&nbsp;<span>–∫—Ä–∞—Å–Ω—ã–º</span></strong
          >). –ï—Å–ª–∏ –≤—ã –ø–æ–∫–∞ –Ω–µ –∑–Ω–∞–µ—Ç–µ —á—Ç–æ –Ω–∞–ø–∏—Å–∞—Ç—å, –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª—è
          –ø–æ–∑–∂–µ :&#41;
        </p>
        <app-button (click)="closeWarningModal()">–ü–æ–Ω—è—Ç–Ω–æ</app-button>
      </div>
    </app-modal>
  </main>
</div>

<app-modal
  [open]="isAssignProjectToProgramError"
  (openChange)="isAssignProjectToProgramError ? clearAssignProjectToProgramError() : null"
>
  <div class="cancel" style="width: 80%; padding: 40px 0px 40px">
    <div class="cancel__top">
      <i
        (click)="clearAssignProjectToProgramError()"
        appIcon
        icon="cross"
        class="cancel__cross"
      ></i>
      <p class="cancel__title text-bold-body-16">–û—à–∏–±–∫–∞ –ø—Ä–∏–≤—è–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∫ –ø—Ä–æ–≥—Ä–∞–º–º–µ!</p>
    </div>

    <p class="text-body-14 cancel__text">
      {{ (errorAssignProjectToProgramModalMessage()?.non_field_errors)![0] }}
    </p>

    <app-button
      class="cancel__button"
      customTypographyClass="text-body-12"
      (click)="clearAssignProjectToProgramError()"
      >–ü–æ–Ω—è—Ç–Ω–æ</app-button
    >
  </div>
</app-modal>

<app-modal
  [open]="isAssignProjectToProgramModalOpen()"
  (openChange)="isAssignProjectToProgramModalOpen.set(!isAssignProjectToProgramModalOpen)"
>
  <div class="cancel" style="width: 80%; padding: 40px 0px 40px">
    <div class="cancel__top">
      <i
        (click)="closeAssignProjectToProgramModal()"
        appIcon
        icon="cross"
        class="cancel__cross"
      ></i>
      <p class="cancel__title text-bold-body-16">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</p>
    </div>

    <p class="text-body-14 cancel__text">
      –ú—ã —Å–æ–∑–¥–∞–ª–∏ –¥—É–±–ª–∏–∫–∞—Ç –ø—Ä–æ–µ–∫—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –ø—Ä–∏–≤—è–∑–∞–ª–∏ –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ
      <span
        ><strong>{{ assignProjectToProgramModalMessage()?.partnerProgram }}</strong></span
      >, —Ç–µ–ø–µ—Ä—å –µ–≥–æ –º–æ–∂–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å!
    </p>

    <app-button
      class="cancel__button"
      customTypographyClass="text-body-12"
      (click)="closeAssignProjectToProgramModal()"
      >–ü–æ–Ω—è—Ç–Ω–æ</app-button
    >
  </div>
</app-modal>

<app-modal [open]="isCompleted" (openChange)="isCompleted = !isCompleted">
  <div class="cancel">
    <div class="cancel__top">
      <i (click)="isCompleted = false" appIcon icon="cross" class="cancel__cross"></i>
      <p class="cancel__title text-bold-body-16">–ü—Ä–æ–µ–∫—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!</p>
    </div>

    <img alt="end" src="assets/images/projects/detail/end.svg" class="cancel__img" />

    <p class="text-body-14 cancel__text">
      –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –±—ã–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º—ã {{ errorModalMessage()?.program_name }}.
      –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –±–æ–ª—å—à–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ.
    </p>
  </div>
</app-modal>

<app-modal [open]="skillsGroupsModalOpen()" class="modal">
  <div class="modal__wrapper">
    <h4 class="text-heading-4">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–∞–≤—ã–∫–æ–≤</h4>
    <div class="modal__content">
      <div class="modal__skills-groups">
        <ul>
          @for (skillsGroup of nestedSkills$ | async; track skillsGroup.id) {
          <li>
            <app-skills-group
              [title]="skillsGroup.name"
              [options]="skillsGroup.skills"
              [selected]="this.vacancyForm.getRawValue().skills"
              (optionToggled)="onToggleSkill($event)"
            ></app-skills-group>
          </li>
          }
        </ul>
      </div>
    </div>
    <app-button (click)="toggleSkillsGroupsModal()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</app-button>
  </div>
</app-modal>

<app-modal
  [open]="isSendDescisionToPartnerProgramProject"
  (openChange)="isSendDescisionToPartnerProgramProject = !isSendDescisionToPartnerProgramProject"
>
  <div class="cancel" style="width: 100%; padding: 40px 20px 20px">
    <div class="cancel__top">
      <i
        (click)="isSendDescisionToPartnerProgramProject = false"
        appIcon
        icon="cross"
        class="cancel__cross"
      ></i>
      <img alt="end" src="assets/images/projects/detail/bid.svg" class="cancel__img" />
      <h4 class="cancel__title text-heading-4">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É?</h4>
    </div>

    <p class="text-body-12 cancel__text">
      –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫—É –Ω–µ–ª—å–∑—è –±—É–¥–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞.
      <br />–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É —Å–µ–π—á–∞—Å?
    </p>

    <div class="cancel__buttons">
      <app-button
        customTypographyClass="text-body-12"
        color="grey"
        (click)="isSendDescisionToPartnerProgramProject = false"
        >–û—Ç–º–µ–Ω–∞</app-button
      >
      <app-button customTypographyClass="text-body-12" (click)="closeSendingDescisionModal()"
        >–û—Ç–ø—Ä–∞–≤–∏—Ç—å</app-button
      >
    </div>
  </div>
</app-modal>
