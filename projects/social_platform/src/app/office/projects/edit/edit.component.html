<!-- @format -->
<div>
  <div class="project__top">
    <div class="project__back" [routerLink]="'/office/projects/' + profileId">
      <i appIcon icon="left-arrow" appSquare="24"></i>
      <h1 class="project__title">—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</h1>
    </div>
    <div class="project__save">
      <app-button
        size="medium"
        customTypographyClass="text-body-12"
        color="red"
        (click)="deleteProject()"
      >
        —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
      </app-button>
      <app-button
        size="medium"
        customTypographyClass="text-body-12"
        appearance="outline"
        [loader]="projFormIsSubmittingAsDraft"
        (click)="saveProjectAsDraft()"
      >
        —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫
      </app-button>
      <app-button
        size="medium"
        customTypographyClass="text-body-12"
        [loader]="projFormIsSubmittingAsPublished"
        (click)="saveProjectAsPublished()"
      >
        {{ isCompetitive ? "–æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É" : "—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å" }}
      </app-button>
    </div>
  </div>

  <main class="project">
    <form [formGroup]="projectForm" class="project__form">
      <app-project-navigation
        style="width: 100%"
        (stepChange)="navigateStep($event)"
      ></app-project-navigation>

      <div class="project__inner">
        @if (editingStep === "main") {
        <app-project-main-step
          style="width: 100%"
          [industries$]="industries$"
          [leaderId]="leaderId"
          [projSubmitInitiated]="projSubmitInitiated"
          [projectId]="profileId"
        ></app-project-main-step>

        } @else if (editingStep === "contacts") {
        <app-project-partner-resources-step
          [projectId]="profileId"
          style="width: 100%"
        ></app-project-partner-resources-step>
        } @else if (editingStep === "achievements") {
        <app-project-achievement-step
          style="width: 100%"
          [projSubmitInitiated]="projSubmitInitiated"
        ></app-project-achievement-step>
        } @else if (editingStep === "vacancies"){
        <app-project-vacancy-step
          style="width: 100%"
          [inlineSkills]="inlineSkills()"
          (searchSkill)="onSearchSkill($event)"
          (addSkill)="onAddSkill($event)"
          (removeSkill)="onRemoveSkill($event)"
          (toggleSkillsGroupsModal)="toggleSkillsGroupsModal()"
        ></app-project-vacancy-step>
        } @else if (editingStep === "team") {
        <app-project-team-step style="width: 100%"></app-project-team-step>
        } @else if (editingStep === "additional") {
        <app-project-additional-step
          #additionalStepComponent
          style="width: 100%"
        ></app-project-additional-step>
        }
      </div>
    </form>
    <app-modal
      [open]="
        (projectForm.invalid || additionalForm.invalid) && projSubmitInitiated && !warningModalSeen
      "
    >
      <div class="project__warning-modal">
        <h3 class="text-bold-body-16">üì¢ –≤–Ω–∏–º–∞–Ω–∏–µ!</h3>
        <p class="text-body-14">
          –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞, –Ω—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ <strong>–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è</strong> (–æ–Ω–∏ –±—É–¥—É—Ç
          <strong>–ø–æ–¥—Å–≤–µ—á–µ–Ω—ã&nbsp;<span>–∫—Ä–∞—Å–Ω—ã–º</span></strong
          >). –ï—Å–ª–∏ –≤—ã –ø–æ–∫–∞ –Ω–µ –∑–Ω–∞–µ—Ç–µ —á—Ç–æ –Ω–∞–ø–∏—Å–∞—Ç—å, –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª—è
          –ø–æ–∑–∂–µ :&#41;
        </p>
        <app-button
          size="medium"
          customTypographyClass="text-body-12"
          appearance="outline"
          (click)="closeWarningModal()"
          >–ø–æ–Ω—è—Ç–Ω–æ</app-button
        >
      </div>
    </app-modal>
  </main>
</div>

<app-modal [open]="isCompleted" (openChange)="isCompleted = !isCompleted">
  <div class="cancel">
    <div class="cancel__top">
      <i (click)="isCompleted = false" appIcon icon="cross" class="cancel__cross"></i>
      <p class="cancel__title text-bold-body-16">–ü—Ä–æ–µ–∫—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!</p>
    </div>

    <img alt="end" src="assets/images/projects/detail/end.svg" class="cancel__img" />

    <p class="text-body-14 cancel__text">
      –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –±—ã–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º—ã {{ errorModalMessage()?.program_name }}.
      –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –±–æ–ª—å—à–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ.
    </p>
  </div>
</app-modal>

<app-modal [open]="skillsGroupsModalOpen()" class="modal">
  <div class="modal__wrapper">
    <p class="text-body-14">–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–∞–≤—ã–∫–æ–≤</p>
    <div class="modal__content">
      <div class="modal__skills-groups">
        <ul>
          @for (skillsGroup of nestedSkills$ | async; track skillsGroup.id) {
          <li>
            <app-skills-group
              [title]="skillsGroup.name"
              [options]="skillsGroup.skills"
              [selected]="this.vacancyForm.getRawValue().skills"
              [hasOpenGroups]="hasOpenSkillsGroups"
              [disabled]="hasOpenSkillsGroups && !openGroupIds.has(skillsGroup.id)"
              (optionToggled)="onToggleSkill($event)"
              (groupToggled)="onGroupToggled($event, skillsGroup.id)"
            ></app-skills-group>
          </li>
          }
        </ul>
      </div>
    </div>
    <app-button size="big" (click)="toggleSkillsGroupsModal()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</app-button>
  </div>
</app-modal>

<app-modal
  [open]="isSendDescisionToPartnerProgramProject"
  (openChange)="isSendDescisionToPartnerProgramProject = !isSendDescisionToPartnerProgramProject"
>
  <div class="cancel" style="width: 100%; padding: 40px 20px 20px">
    <div class="cancel__top">
      <i
        (click)="isSendDescisionToPartnerProgramProject = false"
        appIcon
        icon="cross"
        class="cancel__cross"
      ></i>
      <img alt="end" src="assets/images/projects/detail/bid.svg" class="cancel__img" />
      <h4 class="cancel__title text-heading-4">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É?</h4>
    </div>

    <p class="text-body-12 cancel__text">
      –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫—É –Ω–µ–ª—å–∑—è –±—É–¥–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞.
      <br />–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É —Å–µ–π—á–∞—Å?
    </p>

    <div class="cancel__buttons">
      <app-button
        size="medium"
        customTypographyClass="text-body-12"
        color="grey"
        (click)="isSendDescisionToPartnerProgramProject = false"
        >–û—Ç–º–µ–Ω–∞</app-button
      >
      <app-button
        size="medium"
        customTypographyClass="text-body-12"
        (click)="closeSendingDescisionModal()"
        >–û—Ç–ø—Ä–∞–≤–∏—Ç—å</app-button
      >
    </div>
  </div>
</app-modal>
