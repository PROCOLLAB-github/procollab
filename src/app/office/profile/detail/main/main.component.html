<section class="main" *ngIf="user | async as user">
  <div class="main__content" *ngIf="loggedUserId | async as loggedUserId">
    <div class="main__about">
      <h3 class="text-heading-3 about__title">Обо мне</h3>
      <div *ngIf="user.aboutMe as about" class="about__text">
        <p
          #descEl
          [innerHTML]="about | parseLinks | parseBreaks"
          class="text-body-14"
        ></p>
        <div
          *ngIf="descriptionExpandable"
          class="read-more"
          (click)="onExpandDescription(descEl, 'expanded', readFullDescription)"
        >
          {{ readFullDescription ? "Скрыть" : "Читать полностью" }}
        </div>
      </div>
      <ul *ngIf="user.keySkills?.length" class="about__skills">
        <li *ngFor="let skill of user.keySkills" class="about__skill">
          <app-tag color="accent">{{ skill }}</app-tag>
        </li>
      </ul>
    </div>
    <div class="main__news">
      <app-news-form
        *ngIf="loggedUserId === user.id"
        (addNews)="onAddNews($event)"
      ></app-news-form>
      <ul>
        <li *ngFor="let n of news">
          <app-news-card
            class="news__item"
            [attr.data-id]="n.id"
            [newsItem]="n"
            [isOwner]="loggedUserId === user.id"
            (delete)="onDeleteNews($event)"
            (like)="onLike($event)"
            (edited)="onEditNews($event, n.id)"
          ></app-news-card>
        </li>
      </ul>
    </div>
  </div>
  <div class="main__aside">
    <!-- <div class="profile__section">
      <h3 class="text-bold-body-16">Коммуникации</h3>
    </div> -->
    <div 
      *ngIf="user.projects.length as projectsLength"
      class="projects main__section"
    >
      <div class="main__section-top">
        <h3 class="text-bold-body-16">Проекты</h3>
        <div class="badge badge__projects">
          <i icon="people" appIcon appSquare="22"></i>
        </div>
      </div>
      <ul>
        <li class="project" *ngFor="let p of user.projects.slice(0, 3)" [routerLink]="['/office/projects', p.id]">
          <ng-container
            *ngTemplateOutlet="projectTemp; context: { $implicit: p }"
          ></ng-container>
        </li>
      </ul>
      <div class="projects__remaining" [class.projects__remaining--show]="readAllProjects">
        <ul *ngIf="user.projects">
          <li *ngFor="let project of user.projects.slice(3)">
            <ng-container
              *ngTemplateOutlet="projectTemp; context: { $implicit: project }"
            ></ng-container>
          </li>
        </ul>
      </div>
      <ng-template #projectTemp let-project>
        <div class="project__info">
          <a
            [routerLink]="['/office/projects', project.id]"
            class="text-bold-body-14 project__title"
          >
            {{ project.name }}
          </a>
        </div>
        <p class="text-body-12 project__role">{{ project.collaborator?.role }}</p>
      </ng-template>
      <div
        *ngIf="projectsLength > 3"
        class="read-more"
        (click)="readAllProjects = !readAllProjects"
      >
        {{ readAllProjects ? "Скрыть" : "Читать полностью" }}
      </div>
    </div>
    <div class="main__section">
      <div class="main__section-top">
        <h3 class="text-bold-body-16">Образование/работа</h3>
        <div class="badge badge__organization">
          <i icon="academic-hat" appIcon appWidth="24" appHeight="13" appViewBox="0 0 24 13"></i>
        </div>
      </div>
      <p class="text-bold-body-14">{{ user.organization }}</p>
    </div>
    <div 
      *ngIf="user.achievements.length as achievementsLength"
      class="main__section achievements" 
    >
      <div class="main__section-top">
        <h3 class="text-bold-body-16">Мои достижения</h3>
        <div class="badge badge__achievements">
          <i icon="medal-outlined" appIcon appWidth="20" appHeight="19" appViewBox="0 0 20 19"></i>
        </div>
      </div>
      <ul>
        <li *ngFor="let achievement of user.achievements.slice(0, 3)" class="achievement">
          <p class="achievement__status text-bold-body-14">{{ achievement.status }}</p>
          <p class="achievement__title text-body-12">{{ achievement.title }}</p>
        </li>
      </ul>
      <div
        class="achievements__remaining"
        [class.achievements__remaining--show]="readAllAchievements"
      >
        <ul *ngIf="user.achievements.length">
          <li *ngFor="let achievement of user.achievements.slice(3)" class="achievement">
            <p class="achievement__status text-bold-body-14">{{ achievement.status }}</p>
            <p class="achievement__title text-body-12">{{ achievement.title }}</p>
          </li>
        </ul>
      </div>
      <div
        *ngIf="achievementsLength > 3"
        class="read-more"
        (click)="readAllAchievements = !readAllAchievements"
      >
        {{ readAllAchievements ? "Скрыть" : "Читать полностью" }}
      </div>
    </div>
    <div 
      *ngIf="user.links.length as linksLength"
      class="main__section links"
    >
      <div class="main__section-top">
        <h3 class="text-bold-body-16">Контакты</h3>
        <div class="badge badge__links">
          <i icon="people-filled" appIcon appSquare="20"></i>
        </div>
      </div>
      <ul>
        <li
          class="contact-link text-body-12"
          *ngFor="let link of user.links.slice(0, 3)"
        >
          <ng-container *ngTemplateOutlet="linkTemp; context: { $implicit: link }">
          </ng-container>
        </li>
      </ul>
      <div
        class="links__remaining"
        [class.links__remaining--show]="readAllLinks"
      >
        <ul class="main__links">
          <li
            class="contact-link text-body-12"
            *ngFor="let link of user.links.slice(3)"
          >
            <ng-container *ngTemplateOutlet="linkTemp; context: { $implicit: link }">
            </ng-container>
          </li>
        </ul>
      </div>
      <ng-template #linkTemp let-link>
        <a
          class="contact-link__link"
          *ngIf="link | userLinks as l"
          target="_blank"
          [href]="link"
        >
          <i class="contact-link__icon" appIcon [icon]="l.iconName" appSquare="16"></i>
          <span>{{ l.tag }}</span>
        </a>
      </ng-template>
      <div
        *ngIf="linksLength > 3"
        class="read-more"
        (click)="readAllLinks = !readAllLinks"
      >
        {{ readAllLinks ? "Скрыть" : "Читать полностью" }}
      </div>
    </div>
  </div>
</section>